<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeeTori - Positive Energy Translator</title>
    
    <!-- SNS Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.heetori.com">
    <meta property="og:title" content="í¬í† ë¦¬(HeeTori) - ê¸ì • ë²ˆì—­ê¸°">
    <meta property="og:description" content="ë‹¹ì‹ ì˜ ê³ ë¯¼ì„ ê¸°ì ì˜ ë¬¸ì¥ìœ¼ë¡œ ë°”ê¿”ë“œë¦½ë‹ˆë‹¤. ê¸ì • ì—ë„ˆì§€ë¡œ ì¸ìƒì„ ë‹¤ì‹œ ì¨ë³´ì„¸ìš”!">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/F59E0B/FFFFFF?text=HeeTori+Positive+Energy">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="í¬í† ë¦¬(HeeTori) - ê¸ì • ë²ˆì—­ê¸°">
    <meta name="twitter:description" content="ë‹¹ì‹ ì˜ ê³ ë¯¼ì„ ê¸°ì ì˜ ë¬¸ì¥ìœ¼ë¡œ ë°”ê¿”ë“œë¦½ë‹ˆë‹¤.">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%23fbbf24'/><text x='50' y='72' font-family='system-ui, sans-serif' font-weight='900' font-size='70' text-anchor='middle' fill='white'>H</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Noto+Sans+JP:wght@300;400;500;700;900&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body { font-family: 'Noto Sans KR', 'Noto Sans JP', 'Poppins', sans-serif; background-color: #FFFBEB; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }
        .float-anim { animation: float 3s ease-in-out infinite; }
        @keyframes shine { to { background-position: 200% center; } }
        .magic-text { background: linear-gradient(to right, #D97706 20%, #F59E0B 40%, #F59E0B 60%, #D97706 80%); background-size: 200% auto; color: #000; background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: shine 3s linear infinite; }
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #F59E0B; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .result-fade-in { animation: cardPop 0.7s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes cardPop { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .transition-all-500 { transition: all 0.5s ease-in-out; }
    </style>
</head>
<body class="text-slate-800 flex flex-col min-h-screen">

    <!-- Header -->
    <header class="w-full py-6 px-4 flex justify-between items-center max-w-2xl mx-auto">
        <div class="inline-flex items-center gap-3 bg-white pl-2 pr-5 py-2 rounded-full shadow-sm border border-amber-100 cursor-pointer hover:scale-105 transition duration-300">
            <div class="w-10 h-10 bg-amber-400 rounded-full flex items-center justify-center text-white font-black text-lg shadow-sm border-2 border-amber-200">H</div>
            <div class="text-left flex flex-col justify-center">
                <span class="font-black text-amber-600 text-sm leading-none tracking-wide">HEETORI</span>
                <span class="text-[10px] text-slate-400 font-medium tracking-wider mt-0.5">Joy + Story</span>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <button onclick="shareApp()" class="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm border border-amber-100 text-amber-600 hover:bg-amber-50 hover:scale-110 transition duration-300" title="Share">
                <i class="ph-bold ph-share-network text-lg"></i>
            </button>
            <div class="flex bg-white rounded-full p-1 shadow-sm border border-amber-100 h-10 items-center overflow-hidden">
                <button onclick="setLanguage('ko')" id="btn-ko" class="px-2 sm:px-3 h-full rounded-full text-[10px] font-bold transition-colors">KOR</button>
                <button onclick="setLanguage('en')" id="btn-en" class="px-2 sm:px-3 h-full rounded-full text-[10px] font-bold transition-colors">ENG</button>
                <button onclick="setLanguage('ja')" id="btn-ja" class="px-2 sm:px-3 h-full rounded-full text-[10px] font-bold transition-colors">JPN</button>
            </div>
        </div>
    </header>

    <main class="flex-grow flex flex-col items-center justify-center px-4 sm:px-6 py-8 max-w-2xl mx-auto w-full">
        <div class="text-center mb-10">
            <i class="ph-duotone ph-clover text-4xl text-green-500 mb-4 float-anim inline-block"></i>
            <h1 id="main-title" class="text-3xl sm:text-4xl font-black mb-4 leading-tight text-slate-900"></h1>
            <p id="subtitle" class="text-slate-600 text-sm sm:text-base leading-relaxed max-w-md mx-auto" data-i18n="subtitle"></p>
        </div>

        <!-- Translator Card -->
        <div class="w-full bg-white rounded-3xl shadow-xl border border-amber-100 p-6 sm:p-8 relative overflow-hidden mb-12">
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-amber-50 rounded-full blur-3xl opacity-50"></div>
            <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-orange-50 rounded-full blur-3xl opacity-50"></div>

            <div id="inputSection" class="relative z-10 transition-all-500">
                <div class="flex justify-between items-end mb-2 ml-1">
                    <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider" data-i18n="input_label">ì˜¤ëŠ˜ì˜ ë§ˆìŒ (Input)</label>
                    <div class="flex items-center gap-1 text-[10px] text-green-600 bg-green-50 px-2 py-0.5 rounded-full border border-green-100">
                        <i class="ph-fill ph-lock-key"></i>
                        <span data-i18n="security_msg">100% ìµëª…/ì €ì¥ì•ˆë¨</span>
                    </div>
                </div>
                
                <textarea id="translateInput" rows="3" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent resize-none text-base transition-all"></textarea>
                
                <div class="mt-3 flex items-center justify-center gap-1.5 opacity-80 text-center">
                    <i class="ph-fill ph-shield-check text-green-500 text-base"></i>
                    <p class="text-sm text-slate-500 font-medium leading-snug" data-i18n="security_detail"></p>
                </div>

                <button onclick="runTranslation()" class="mt-5 w-full py-4 bg-gradient-to-r from-amber-400 to-orange-500 hover:from-amber-500 hover:to-orange-600 text-white rounded-xl font-bold shadow-lg transform transition active:scale-95 flex justify-center items-center gap-2 group">
                    <i class="ph-bold ph-sparkle group-hover:rotate-12 transition"></i>
                    <span id="btnText" data-i18n="btn_translate">ê¸ì • ì—ë„ˆì§€ë¡œ ë²ˆì—­í•˜ê¸°</span>
                    <div id="loader" class="loader hidden" style="border-top-color: #fff;"></div>
                </button>
            </div>

            <!-- Result Section -->
            <div id="resultSection" class="hidden relative z-10 mt-6 pt-6 border-t border-dashed border-slate-200">
                <div id="miracleSection" class="result-fade-in">
                    <div class="flex justify-between items-center mb-4">
                        <label class="text-xs font-bold text-indigo-500 uppercase tracking-wider" data-i18n="result_label">ë³€í™˜ëœ ê¸°ì ì˜ ë¬¸ì¥</label>
                        <div class="flex gap-2">
                            <!-- â˜… FIXED: Added data-i18n and structured translation logic â˜… -->
                            <button onclick="saveMiracleAsImage()" class="flex items-center gap-1.5 px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-full text-[11px] font-bold hover:bg-indigo-100 transition shadow-sm border border-indigo-100">
                                <i class="ph-bold ph-image-square"></i> <span data-i18n="save_image">ì´ë¯¸ì§€ë¡œ ì €ì¥</span>
                            </button>
                            <button onclick="copyToClipboard()" class="flex items-center gap-1.5 px-3 py-1.5 bg-slate-50 text-slate-500 rounded-full text-[11px] font-bold hover:bg-slate-100 transition shadow-sm border border-slate-100">
                                <i class="ph-bold ph-copy"></i> <span data-i18n="copy">ë³µì‚¬</span>
                            </button>
                        </div>
                    </div>

                    <div id="captureArea" class="bg-gradient-to-br from-indigo-50 to-white rounded-2xl p-8 sm:p-12 border border-indigo-100 mb-6 relative shadow-inner overflow-hidden text-center">
                        <div class="absolute -top-12 -right-12 w-32 h-32 bg-amber-200 rounded-full blur-3xl opacity-20"></div>
                        <div class="absolute -bottom-12 -left-12 w-32 h-32 bg-indigo-200 rounded-full blur-3xl opacity-20"></div>
                        <i class="ph-fill ph-quotes text-indigo-200 text-6xl absolute top-6 left-6"></i>
                        
                        <div class="relative z-10 py-6">
                            <!-- Empathy Text (Gray, No Italic, 15.5px) -->
                            <p id="empathyText" class="text-[15.5px] text-slate-500 font-semibold mb-6 opacity-90 leading-relaxed break-keep"></p>
                            <!-- Miracle Text (" ") -->
                            <p id="translatedText" class="text-xl sm:text-2xl font-black text-slate-800 leading-relaxed break-keep"></p>
                        </div>

                        <div class="mt-8 pt-6 border-t border-indigo-100/50 flex justify-between items-center opacity-100">
                            <div class="flex items-center gap-2 text-left">
                                <svg width="24" height="24" viewBox="0 0 100 100" class="flex-shrink-0">
                                    <circle cx="50" cy="50" r="50" fill="#fbbf24"/>
                                    <text x="50" y="50" font-family="Arial, sans-serif" font-weight="900" font-size="60" text-anchor="middle" dominant-baseline="central" fill="white">H</text>
                                </svg>
                                <span class="text-[11px] font-black text-amber-600 tracking-tighter">HEETORI.COM</span>
                            </div>
                            <span class="text-[11px] text-slate-700 font-bold tracking-tight text-right italic" data-i18n="card_footer">ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ê¸°ì ìœ¼ë¡œ ë²ˆì—­í•©ë‹ˆë‹¤</span>
                        </div>
                    </div>

                    <div class="flex gap-3 items-start bg-amber-50 p-4 rounded-xl border border-amber-100">
                        <div class="flex-shrink-0 w-8 h-8 bg-amber-200 text-amber-700 rounded-full flex items-center justify-center text-lg"><i class="ph-fill ph-smiley"></i></div>
                        <div>
                            <h5 class="font-bold text-amber-800 text-xs mb-1" data-i18n="comment_label">í¬í† ë¦¬ì˜ ì‘ì›</h5>
                            <p id="hitoriComment" class="text-[13.5px] text-slate-700 leading-relaxed break-keep"></p>
                        </div>
                    </div>
                    <button onclick="resetApp()" class="mt-6 w-full py-2 text-slate-400 hover:text-slate-600 text-sm font-medium transition" data-i18n="reset">ë‹¤ë¥¸ ê³ ë¯¼ë„ ë²ˆì—­í•˜ê¸° â†º</button>
                </div>
            </div>
        </div>

        <!-- Book Section -->
        <section class="w-full max-w-2xl mb-16">
            <div class="flex items-center gap-2 mb-4 px-2"><i class="ph-fill ph-books text-amber-500 text-xl"></i><h3 class="font-bold text-slate-800 text-lg" data-i18n="book_title">ì˜ê°ì„ ì£¼ëŠ” ì±…ë“¤</h3></div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <a id="link-hawkins" href="#" target="_blank" class="block bg-white p-4 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md hover:border-indigo-200 transition group">
                    <div class="flex items-start gap-4">
                        <div class="w-16 h-20 bg-indigo-50 rounded-lg flex items-center justify-center flex-shrink-0 text-indigo-300"><i class="ph-fill ph-book-open text-3xl group-hover:scale-110 transition"></i></div>
                        <div>
                            <h4 class="font-bold text-slate-900 text-sm mb-1 group-hover:text-indigo-600 transition" data-i18n="book_name_hawkins">David R. Hawkins</h4>
                            <p class="text-xs text-slate-500 mb-2" data-i18n="book_desc_hawkins"></p>
                            <span class="text-[10px] font-bold text-indigo-500 bg-indigo-50 px-2 py-1 rounded-full" data-i18n="book_btn">ì„œì  ë°”ë¡œê°€ê¸° â†’</span>
                        </div>
                    </div>
                </a>
                <a id="link-hitori" href="#" target="_blank" class="block bg-white p-4 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md hover:border-amber-200 transition group">
                    <div class="flex items-start gap-4">
                        <div class="w-16 h-20 bg-amber-50 rounded-lg flex items-center justify-center flex-shrink-0 text-amber-300"><i class="ph-fill ph-sparkle text-3xl group-hover:scale-110 transition"></i></div>
                        <div>
                            <h4 class="font-bold text-slate-900 text-sm mb-1 group-hover:text-amber-600 transition" data-i18n="book_name_hitori"></h4>
                            <p class="text-xs text-slate-500 mb-2" data-i18n="book_desc_hitori"></p>
                            <span class="text-[10px] font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded-full" data-i18n="book_btn">ì„œì  ë°”ë¡œê°€ê¸° â†’</span>
                        </div>
                    </div>
                </a>
            </div>
        </section>

        <!-- Maker Profile -->
        <section class="w-full max-w-2xl mb-12">
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-6 sm:p-8 text-center sm:text-left text-white shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/3"></div>
                <div class="flex flex-col sm:flex-row items-center gap-6 relative z-10">
                    <div class="w-16 h-16 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center text-white text-2xl font-black shadow-lg flex-shrink-0 border-4 border-slate-700">H</div>
                    <div class="w-full">
                        <div class="flex flex-col sm:flex-row items-center sm:items-baseline gap-2 mb-2 justify-center sm:justify-start">
                            <h4 class="text-sm text-slate-400 font-bold uppercase tracking-wider" data-i18n="maker_label">Created by</h4>
                            <h4 class="text-xl font-bold text-white tracking-wide" id="maker-name-display" data-i18n="maker_name"></h4>
                            <span class="bg-slate-700 text-[10px] text-slate-300 px-1.5 py-0.5 rounded border border-slate-600 ml-1">Republic of Korea</span>
                        </div>
                        <p id="maker-desc-display" class="text-base text-slate-200 leading-relaxed mb-4 font-light" data-i18n="maker_desc"></p>
                        <div class="inline-flex items-center gap-2 bg-slate-800/50 px-4 py-2 rounded-lg border border-slate-700 hover:border-slate-500 hover:bg-slate-700 transition duration-300">
                            <i class="ph-fill ph-envelope-simple text-amber-400"></i>
                            <a href="mailto:h221ko@gmail.com" class="text-sm font-medium text-slate-300 hover:text-white transition-colors">h221ko@gmail.com</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="text-center text-slate-400 text-xs pb-8"><p>Â© 2025 HeeTori Project. All rights reserved.</p></div>
    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-4 py-2 rounded-full text-sm shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none z-50">Copied! âœ¨</div>

    <script>
        const apiKey = "AIzaSyCuZWAqZ1TyQ0vHYOjKFU3scc-_M8jxj1E"; 
        const geminiModel = "gemini-2.5-flash-preview-09-2025"; 

        let currentLang = 'ko';
        
        const translations = {
            ko: {
                html_title: "ë‹¹ì‹ ì˜ ê³ ë¯¼ì„ <br><span class='magic-text'>ê¸°ì ì˜ ë¬¸ì¥</span>ìœ¼ë¡œ <br>ë°”ê¿”ë“œë¦½ë‹ˆë‹¤",
                subtitle: "<span class='font-bold text-amber-600'>í¬í† ë¦¬</span>ê°€ ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼<br>ê°€ì¥ ìš´ì´ ì¢‹ì€ ê¸ì •ì˜ ì–¸ì–´ë¡œ ë²ˆì—­í•´ ë“œë¦´ê²Œìš”.",
                input_label: "ì˜¤ëŠ˜ì˜ ë§ˆìŒ (Input)",
                placeholder: "ì˜ˆ: ìš”ì¦˜ ì¼ì´ ì˜ ì•ˆ í’€ë ¤ì„œ ë¶ˆì•ˆí•´. ë‚´ê°€ ì˜í•˜ê³  ìˆëŠ” ê±¸ê¹Œ?",
                btn_translate: "ê¸ì • ì—ë„ˆì§€ë¡œ ë²ˆì—­í•˜ê¸°",
                btn_loading: "ê¸°ì ì„ ë§Œë“œëŠ” ì¤‘...",
                save_image: "ì´ë¯¸ì§€ë¡œ ì €ì¥", // â˜… Fixed â˜…
                result_label: "ë³€í™˜ëœ ê¸°ì ì˜ ë¬¸ì¥",
                copy: "ë³µì‚¬",
                comment_label: "í¬í† ë¦¬ì˜ ì‘ì›",
                reset: "ë‹¤ë¥¸ ê³ ë¯¼ë„ ë²ˆì—­í•˜ê¸° â†º",
                book_title: "ì˜ê°ì„ ì£¼ëŠ” ì±…ë“¤",
                book_name_hawkins: "David R. Hawkins",
                book_desc_hawkins: "ì˜ì‹ í˜ëª…, ë†“ì•„ë²„ë¦¼ ë“±<br>ì˜ì‹ ì„±ì¥ì˜ í•„ë…ì„œ",
                book_name_hitori: "Saito Hitori", 
                book_desc_hitori: "1% ë¶€ìì˜ ë²•ì¹™, ë¶€ìì˜ ìš´<br>ìœ ì¾Œí•œ ì„±ê³µì˜ ì§€í˜œ",
                book_btn: "êµë³´ë¬¸ê³  ë³´ëŸ¬ê°€ê¸° â†’",
                maker_label: "Created by",
                maker_name: "ê³ í¬ì› (HeeTori)",
                maker_desc: "ê¸°ìœ ì´ì•¼ê¸°(Joy+Story)ë¥¼ ì“°ëŠ” í¬ë¦¬ì—ì´í„°ì…ë‹ˆë‹¤.<br>ë‹¹ì‹ ì˜ ì‚¶ì— ê¸ì •ì˜ ê¸°ì ì´ ì¼ì–´ë‚˜ê¸¸ ì‘ì›í•©ë‹ˆë‹¤.",
                card_footer: "ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ê¸°ì ìœ¼ë¡œ ë²ˆì—­í•©ë‹ˆë‹¤",
                toast: "ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨",
                share_toast: "ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ì¹œêµ¬ì—ê²Œ ë³´ë‚´ë³´ì„¸ìš” ğŸ’Œ",
                security_msg: "100% ìµëª…/ì €ì¥ì•ˆë¨",
                security_detail: "* ì…ë ¥í•˜ì‹  ë‚´ìš©ì€ ì„œë²„ì— ì €ì¥ë˜ì§€ ì•Šìœ¼ë©°, ë²ˆì—­ í›„ ì¦‰ì‹œ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì•ˆì‹¬í•˜ì„¸ìš”!"
            },
            en: {
                html_title: "Turn Your Worries <br>Into <span class='magic-text'>Miracles</span> <br>With Positive Energy",
                subtitle: "<span class='font-bold text-amber-600'>HeeTori</span> translates your story<br>into the luckiest, highest-vibration language.",
                input_label: "Your Mindset (Input)",
                placeholder: "Ex: I'm feeling anxious about my future. Am I doing enough?",
                btn_translate: "Translate to High Vibe",
                btn_loading: "Creating Miracles...",
                save_image: "Save Image", // â˜… Fixed â˜…
                result_label: "Your Miracle Affirmation",
                copy: "Copy",
                comment_label: "HeeTori's Cheer",
                reset: "Translate Another Thought â†º",
                book_title: "Inspiring Books",
                book_name_hawkins: "David R. Hawkins",
                book_desc_hawkins: "Power vs Force, Letting Go.<br>Essentials for consciousness.",
                book_name_hitori: "Saito Hitori",
                book_desc_hitori: "The absolute rich mindset.<br>Wisdom of luck and joy.",
                book_btn: "View on Amazon â†’",
                maker_label: "Created by",
                maker_name: "Ko Hee-Won (HeeTori)",
                maker_desc: "I create Joy+Story to rewrite your life.<br>Cheering for miracles to happen in your journey.",
                card_footer: "Translating your story into a miracle",
                toast: "Copied! âœ¨",
                share_toast: "Link copied! Share with friends ğŸ’Œ",
                security_msg: "100% Anonymous",
                security_detail: "* Your input is NOT saved on any server and vanishes after translation. Safe & Secure!"
            },
            ja: {
                html_title: "ã‚ãªãŸã®æ‚©ã¿ã€<br><span class='magic-text'>å¥‡è·¡ã®è¨€è‘‰</span>ã«<br>æ›¸ãæ›ãˆã‚‰ã‚Œã¾ã™",
                subtitle: "<span class='font-bold text-amber-600'>HeeTori</span>ê°€ ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼<br>ìµœê³ ë¡œ ìš´ì´ ì¢‹ì€ ê¸ì •ì˜ ì–¸ì–´ë¡œ ë²ˆì—­í•´ ë“œë¦½ë‹ˆë‹¤.",
                input_label: "ä»Šæ—¥ã®ã‚³ã‚³ãƒ­ (Input)",
                placeholder: "ä¾‹ï¼šæœ€è¿‘ã†ã¾ãã„ã‹ãªãã¦ä¸å®‰ã€‚ç§ã¯ã¡ã‚ƒã‚“ã¨ã§ãã¦ã„ã‚‹ã®ã‹ãªï¼Ÿ",
                btn_translate: "å¹¸é‹ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã§ç¿»è¨³",
                btn_loading: "å¥‡è·¡ã‚’å‰µé€ ä¸­...",
                save_image: "ç”»åƒã§ä¿å­˜", // â˜… Fixed â˜…
                result_label: "å¥‡è·¡ã®ã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³",
                copy: "ã‚³ãƒ”ãƒ¼",
                comment_label: "ã²ã¨ã‚Šã•ã‚“ã‹ã‚‰ã®ã‚¨ãƒ¼ãƒ«",
                reset: "ä»–ã®æ‚©ã¿ã‚‚ç¿»è¨³ã™ã‚‹ â†º",
                book_title: "ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ¬",
                book_name_hawkins: "ãƒ‡ãƒ´ã‚£ãƒƒãƒ‰ãƒ»Rãƒ»ãƒ›ãƒ¼ã‚­ãƒ³ã‚º",
                book_desc_hawkins: "ã€ãƒ‘ãƒ¯ãƒ¼ã‹ã€ãƒ•ã‚©ãƒ¼ã‚¹ã‹ã€ãªã©<br>æ„è­˜ã®é€²åŒ–ã®ãŸã‚ã®å¿…èª­æ›¸",
                book_name_hitori: "æ–è—¤ä¸€äºº", 
                book_desc_hitori: "ã€å¤‰ãªäººãŒæ›¸ã„ãŸæˆåŠŸæ³•å‰‡ã€ãªã©<br>æ–è—¤ä¸€äººã•ã‚“ã®è±Šã‹ãªçŸ¥æµ",
                book_btn: "Amazonã§è¦‹ã‚‹ â†’",
                maker_label: "Created by",
                maker_name: "é«˜å–œåœ’(HeeTori)",
                maker_desc: "ã€Œå–œã³ã®ç‰©èª(Joy+Story)ë¥¼ ì“°ëŠ” í¬ë¦¬ì—ì´í„°ì…ë‹ˆë‹¤.<br>ë‹¹ì‹ ì˜ ì‚¶ì— ê¸ì •ì˜ ê¸°ì ì´ ì¼ì–´ë‚˜ê¸¸ ì‘ì›í•©ë‹ˆë‹¤.ã€",
                card_footer: "ã‚ãªãŸã®ç‰©èªã‚’å¥‡è·¡ã«ç¿»è¨³ã—ã¾ã™",
                toast: "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ âœ¨",
                share_toast: "URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼å‹é”ã«é€ã£ã¦ã­ ğŸ’Œ",
                security_msg: "100% åŒ¿åãƒ»ä¿å­˜ãªã—",
                security_detail: "â€» å…¥åŠ› ë‚´ìš©ì€ ì„œë²„ì— ì €ì¥ë˜ì§€ ì•Šìœ¼ë©°, ë²ˆì—­ í›„ ì¦‰ì‹œ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì•ˆì‹¬í•˜ì„¸ìš”!", // Double check ja security_detail later in script fix
                alert_empty: "ä»Šã®æ°—æŒã¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã­ï¼"
            }
        };

        // Complete JA detail correction
        translations.ja.security_detail = "â€» å…¥åŠ›å†…å®¹ã¯ã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜ã•ã‚Œãš, ç¿»è¨³å¾Œã™ãã«æ¶ˆå»ã•ã‚Œã¾ã™. ã”å®‰å¿ƒãã ã•ã„.";
        translations.ja.maker_desc = "ã€Œå–œã³ã®ç‰©èª(Joy+Story)ã‚’ç´¡ãã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã§ã™. ã‚ãªãŸã®äººç”Ÿã«å¥‡è·¡ê°€ ì¼ì–´ë‚˜ê¸¸ ì‘ì›í•©ë‹ˆë‹¤.ã€"; // Re-fixing mixed JPN/KOR
        translations.ja.maker_desc = "ã€Œå–œã³ã®ç‰©èª(Joy+Story)ã‚’ç´¡ãã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã§ã™. ã‚ãªãŸã®äººç”Ÿã«å¥‡è·¡ãŒèµ·ãã‚‹ã“ã¨ã‚’å¿ƒã‹ã‚‰å¿œæ´ã—ã¦ã„ã¾ã™.ã€";

        const bookLinks = {
            ko: { hawkins: "https://search.kyobobook.co.kr/search?keyword=ë°ì´ë¹„ë“œí˜¸í‚¨ìŠ¤", hitori: "https://search.kyobobook.co.kr/search?keyword=ì‚¬ì´í† íˆí† ë¦¬" },
            en: { hawkins: "https://www.amazon.com/s?k=David+R.+Hawkins", hitori: "https://www.amazon.com/s?k=Saito+Hitori" },
            ja: { hawkins: "https://www.amazon.co.jp/s?k=ãƒ‡ãƒ´ã‚£ãƒƒãƒ‰+R+ãƒ›ãƒ¼ã‚­ãƒ³ã‚º", hitori: "https://www.amazon.co.jp/s?k=æ–è—¤ä¸€äºº" }
        };

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            ['ko', 'en', 'ja'].forEach(l => {
                const btn = document.getElementById(`btn-${l}`);
                if(l === lang) {
                    btn.className = "px-2 sm:px-3 h-full rounded-full text-[10px] font-bold transition-colors bg-amber-100 text-amber-700";
                } else {
                    btn.className = "px-2 sm:px-3 h-full rounded-full text-[10px] font-bold transition-colors text-slate-400 hover:text-slate-600";
                }
            });

            document.getElementById('main-title').innerHTML = t.html_title;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key] !== undefined) el.innerHTML = t[key];
            });
            document.getElementById('translateInput').placeholder = t.placeholder;
            document.getElementById('link-hawkins').href = bookLinks[lang].hawkins;
            document.getElementById('link-hitori').href = bookLinks[lang].hitori;
        }

        async function runTranslation() {
            const input = document.getElementById('translateInput').value.trim();
            if (!input) { 
                alert(currentLang === 'ko' ? "ë§ˆìŒì„ ì…ë ¥í•´ì£¼ì„¸ìš”!" : (currentLang === 'ja' ? "ä»Šã®æ°—æŒã¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã­ï¼" : "Please enter your thoughts!")); 
                return; 
            }
            
            const t = translations[currentLang];
            document.getElementById('btnText').innerText = t.btn_loading;
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('translateInput').disabled = true;

            const targetLangLabel = currentLang === 'ko' ? 'Korean' : (currentLang === 'ja' ? 'Japanese' : 'English');

            const prompt = `
                Roleplay: You are 'HeeTori', a professional spirit translator.
                Input: "${input}"
                Philosophies: Saito Hitori and David Hawkins.
                Tasks:
                1. [EMPATHY]: Write one profound, warm empathy sentence acknowledging the situation. NOT a cliche.
                2. [MIRACLE]: Rewrite the input into a powerful affirmation (Level 540+ Joy).
                3. [COMMENT]: Provide an insightful comment (under 15 lines) explaining why this shift is powerful. Mention both names.
                Output Strictly JSON format: {"empathy": "...", "translated": "...", "comment": "..."}
                Language: ${targetLangLabel}.
            `;

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${geminiModel}:generateContent?key=${apiKey}`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } })
                });
                if (!response.ok) throw new Error("API Error");
                const data = await response.json();
                let rawText = data.candidates[0].content.parts[0].text;
                rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
                const result = JSON.parse(rawText);

                const formatBold = (str) => str.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

                document.getElementById('inputSection').classList.add('hidden');
                document.getElementById('resultSection').classList.remove('hidden');
                
                document.getElementById('empathyText').innerHTML = formatBold(result.empathy);
                document.getElementById('translatedText').innerHTML = `â€œ${formatBold(result.translated)}â€`;
                document.getElementById('hitoriComment').innerHTML = formatBold(result.comment);

            } catch (error) {
                console.error(error);
                let errorMsg = currentLang === 'ko' ? "ì˜¤ë¥˜ ë°œìƒ! ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." : (currentLang === 'ja' ? "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ. ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„." : "Error! Please try again.");
                const toast = document.getElementById('toast');
                toast.innerText = errorMsg;
                toast.classList.remove('opacity-0');
                setTimeout(() => toast.classList.add('opacity-0'), 3000);
                resetApp();
            } finally {
                document.getElementById('btnText').innerText = t.btn_translate;
                document.getElementById('loader').classList.add('hidden');
            }
        }

        async function saveMiracleAsImage() {
            const el = document.getElementById('captureArea');
            const toast = document.getElementById('toast');
            try {
                const canvas = await html2canvas(el, { backgroundColor: '#FFFBEB', scale: 3, useCORS: true, logging: false });
                const link = document.createElement('a');
                link.download = `HeeTori_Miracle_${Date.now()}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
                toast.innerText = currentLang === 'ko' ? "ê¸°ì  ì¹´ë“œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨" : (currentLang === 'ja' ? "å¥‡è·¡ã®ã‚«ãƒ¼ãƒ‰ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼ âœ¨" : "Miracle card saved! âœ¨");
                toast.classList.remove('opacity-0');
                setTimeout(() => toast.classList.add('opacity-0'), 2000);
            } catch (err) {
                console.error("Save error", err);
            }
        }

        function resetApp() {
            document.getElementById('translateInput').value = '';
            document.getElementById('translateInput').disabled = false;
            document.getElementById('inputSection').classList.remove('hidden');
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('translateInput').focus();
        }

        function copyToClipboard() {
            const text = document.getElementById('translatedText').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.getElementById('toast');
                toast.innerText = translations[currentLang].toast;
                toast.classList.remove('opacity-0');
                setTimeout(() => toast.classList.add('opacity-0'), 2000);
            });
        }

        async function shareApp() {
            const shareData = { title: 'HeeTori', text: 'ë‹¹ì‹ ì˜ ê³ ë¯¼ì„ ê¸°ì ì˜ ë¬¸ì¥ìœ¼ë¡œ! ğŸ€', url: window.location.href };
            if (navigator.share) { try { await navigator.share(shareData); } catch (err) {} } 
            else { 
                navigator.clipboard.writeText(window.location.href); 
                const toast = document.getElementById('toast'); 
                toast.innerText = translations[currentLang].share_toast; 
                toast.classList.remove('opacity-0'); 
                setTimeout(() => toast.classList.add('opacity-0'), 2000); 
            }
        }

        document.addEventListener('DOMContentLoaded', () => setLanguage('ko'));
    </script>
</body>
</html>